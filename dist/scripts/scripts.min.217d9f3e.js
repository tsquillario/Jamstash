"use strict";angular.module("JamStash",["ngCookies","ngRoute","ngSanitize","ui.keypress","angular-underscore/utils","jamstash.subsonic.controller","jamstash.archive.controller","jamstash.player.controller","jamstash.queue.controller","jamstash.settings.controller","jamstash.persistence"]).config(["$routeProvider",function(a){a.when("/index",{redirectTo:"/library"}).when("/settings",{templateUrl:"settings/settings.html",controller:"SettingsController"}).when("/queue",{templateUrl:"queue/queue.html",controller:"QueueController"}).when("/library",{templateUrl:"subsonic/subsonic.html",controller:"SubsonicController"}).when("/library/:artistId",{templateUrl:"subsonic/subsonic.html",controller:"SubsonicController",reloadOnSearch:!1}).when("/library/:artistId/:albumId",{templateUrl:"subsonic/subsonic.html",controller:"SubsonicController",reloadOnSearch:!1}).when("/podcasts",{templateUrl:"podcasts/podcasts.html",controller:"PodcastController"}).when("/archive",{templateUrl:"archive/archive.html",controller:"ArchiveController"}).when("/archive/:artist",{templateUrl:"archive/archive.html",controller:"ArchiveController"}).when("/archive/:artist/:album",{templateUrl:"archive/archive.html",controller:"ArchiveController"}).otherwise({redirectTo:"/index"})}]).config(["$httpProvider",function(a){a.interceptors.push(["$rootScope","$location","$q","globals",function(a,b,c,d){return{request:function(c){a.loggedIn=!1,""!=d.settings.Username&&""!=d.settings.Password&&""!=d.settings.Server&&(a.loggedIn=!0);var e="";return e=b.path(),d.settings.Debug&&console.log("Logged In: "+a.loggedIn),d.settings.Debug&&console.log("Current Path: "+e),!a.loggedIn&&"/settings"!=e&&e.search("archive")<0&&b.path("/settings"),c},responseError:function(d){return 401===d.status&&"/settings"!=b.path()&&(a.loggedIn=!1,b.path("/settings")),c.reject(d)}}}])}]),angular.module("jamstash.settings.controller",["jamstash.settings.service","jamstash.persistence"]).controller("SettingsController",["$rootScope","$scope","$location","utils","globals","json","notifications","persistence","subsonic",function(a,b,c,d,e,f,g,h,i){a.hideQueue(),b.settings=e.settings,b.Timeouts=[{id:1e4,name:10},{id:2e4,name:20},{id:3e4,name:30},{id:4e4,name:40},{id:5e4,name:50},{id:6e4,name:60},{id:9e4,name:90},{id:12e4,name:120}],b.Protocols=["json","jsonp"],b.Themes=["Default","Dark"],b.SearchTypes=e.SearchTypes,b.Layouts=e.Layouts,b.$watch("settings.HideAZ",function(){e.settings.HideAZ?$("#AZIndex").hide():$("#AZIndex").show()}),b.reset=function(){h.deleteSettings(),b.loadSettings()},b.save=function(){""!==b.settings.Password&&"enc:"!=e.settings.Password.substring(0,4)&&(b.settings.Password="enc:"+d.HexEncode(b.settings.Password)),0!=b.settings.Server.indexOf("http://")&&0!=b.settings.Server.indexOf("https://")&&(b.settings.Server="http://"+b.settings.Server),b.settings.NotificationSong&&(g.requestPermissionIfRequired(),g.isSupported()||alert("HTML5 Notifications are not available for your current browser, Sorry :(")),b.settings.NotificationNowPlaying&&(g.requestPermissionIfRequired(),g.isSupported()||alert("HTML5 Notifications are not available for your current browser, Sorry :(")),b.settings.SaveTrackPosition?h.saveQueue():(h.deleteTrackPosition(),h.deleteQueue()),b.settings.Theme&&d.switchTheme(e.settings.Theme),b.settings.ShowQueue?a.showQueue():a.hideQueue(),h.saveSettings(b.settings),g.updateMessage("Settings Updated!",!0),b.loadSettings(),""!==e.settings.Server&&""!==e.settings.Username&&""!==e.settings.Password&&i.ping().then(function(b){e.settings.ApiVersion=b.version,c.path("/library").replace(),a.showIndex=!0},function(a){var b;b=void 0!==a.subsonicError?a.reason+" "+a.subsonicError.message:void 0!==a.httpError?a.reason+" HTTP error "+a.httpError:a.reason,g.updateMessage(b,!0)})},f.getChangeLog(function(a){b.changeLog=a.slice(0,10),e.ChangeLog=a}),b.changeLogShowMore=function(){f.getChangeLog(function(a){b.changeLog=a})},b.setupDemo=function(){var b="android-guest",f="guest",g="http://demo.subsonic.org";d.confirmDelete("Do you want to connect to the Subsonic Demo server?")&&(e.settings.Username=b,e.settings.Password=f,e.settings.Server=g,c.path("/library").replace(),a.showIndex=!0)},"undefined"!=typeof c.search().url&&""===b.settings.Server&&(e.settings.Debug&&console.log("Setting Provided: "+c.search().url),b.settings.Server=c.search().url),"undefined"!=typeof c.search().u&&""===b.settings.Username&&(e.settings.Debug&&console.log("Setting Provided: "+c.search().u),b.settings.Username=c.search().u)}]),angular.module("jamstash.settings.service",[]).service("globals",function(){this.SearchTypes=[{id:0,name:"Song"},{id:1,name:"Album"},{id:2,name:"Artist"}],this.Layouts=[{id:"grid",name:"Grid"},{id:"list",name:"List"}],this.AlbumSorts=[{id:"default",name:"Default Sort"},{id:"artist",name:"Artist"},{id:"album",name:"Album"},{id:"track",name:"Track"},{id:"createdate desc",name:"Date Added"}],this.settings={Url:"http://jamstash.com/#/archive/",Username:"",Password:"",Server:"",Timeout:2e4,Protocol:"jsonp",ApplicationName:"Jamstash",ApiVersion:"1.6.0",AutoPlaylists:"",AutoPlaylistSize:25,AutoAlbumSize:15,HideAZ:!1,ScrollTitle:!0,NotificationSong:!0,NotificationNowPlaying:!1,SaveTrackPosition:!1,ForceFlash:!1,Theme:"Default",DefaultLibraryLayout:this.Layouts[0],DefaultSearchType:this.SearchTypes[0],DefaultAlbumSort:this.AlbumSorts[0],DefaultArchiveAlbumSort:"date desc",Jukebox:!1,AutoPlay:!1,LoopQueue:!1,Repeat:!1,Debug:!1,ShowQueue:!1},this.SavedCollections=[],this.SavedGenres=[],this.Player1="#playdeck_1",this.archiveUrl="https://archive.org/",this.ChangeLog=null,this.Messages=[],this.BaseURL=function(){return this.settings.Server+"/rest"},this.BaseParams=function(){return"u="+this.settings.Username+"&p="+this.settings.Password+"&f="+this.settings.Protocol+"&v="+this.settings.ApiVersion+"&c="+this.settings.ApplicationName},this.BaseJSONParams=function(){return"u="+this.settings.Username+"&p="+this.settings.Password+"&f=json&v="+this.settings.ApiVersion+"&c="+this.settings.ApplicationName}}).factory("json",["$http",function(a){return{getCollections:function(b){a.get("archive/json_collections.json").success(b)},getChangeLog:function(b){a.get("common/json_changelog.json").success(b)}}}]),angular.module("jamstash.model",["jamstash.utils"]).service("model",["utils",function(a){this.Index=function(a,b){this.name=a,this.artist=b},this.Artist=function(a,b){this.id=a,this.name=b},this.Album=function(a,b,c,d,e,f,g,h,i,j,k,l){this.id=a,this.parentid=b,this.name=c,this.artist=d,this.artistId=e,this.coverartthumb=f,this.coverartfull=g,this.date=h,this.starred=i,this.description=j,this.url=k,this.type=l},this.Song=function(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){this.id=b,this.parentid=c,this.track=d,this.name=e,this.artist=f,this.artistId=g,this.album=h,this.albumId=i,this.coverartthumb=j,this.coverartfull=k,this.duration=l,this.time=""===l?"00:00":a.secondsToTime(l),this.rating=m,this.starred=n,this.suffix=o,this.specs=p,this.url=q,this.position=r,this.selected=!1,this.playing=!1,this.description=s,this.displayName=this.name+" - "+this.album+" - "+this.artist}}]).service("map",["$http","globals","utils","model",function(a,b,c,d){this.mapAlbum=function(a){var e,f,g,h,i,j=a;"undefined"!=typeof j.coverArt&&(f=b.BaseURL()+"/getCoverArt.view?"+b.BaseParams()+"&size=160&id="+j.coverArt,g=b.BaseURL()+"/getCoverArt.view?"+b.BaseParams()+"&id="+j.coverArt),h="undefined"!=typeof j.starred?!0:!1,e="undefined"!=typeof j.title?j.title:j.name;var k;return k=j.isDir?"byfolder":"bytag",i=void 0!==j.artist?j.artist.toString():"",new d.Album(j.id,j.parent,e,i,j.artistId,f,g,c.formatDate(new Date(j.created),"yyyy-MM-dd h:mm a"),h,"","",k)},this.mapAlbums=function(a){var b=[],c=this.mapAlbum;return angular.forEach(a,function(a){b.push(c(a))}),b},this.mapSong=function(a){var c,e,f,g,h,i,j,k=a,l="",m="",n="";"undefined"!=typeof k.coverArt?(m=b.BaseURL()+"/getCoverArt.view?"+b.BaseParams()+"&size=30&id="+k.coverArt,n=b.BaseURL()+"/getCoverArt.view?"+b.BaseParams()+"&id="+k.coverArt):(m="images/albumdefault_60.a457ae64.jpg",n="images/albumdefault_160.973dd405.jpg"),j="undefined"==typeof k.description?"":k.description,f="undefined"==typeof k.artist?"&nbsp;":k.artist.toString(),e="undefined"==typeof k.title?"&nbsp;":k.title.toString(),g="undefined"==typeof k.track?"&nbsp;":k.track.toString(),h="undefined"!=typeof k.starred?!0:!1,void 0!==k.bitRate&&(l+=k.bitRate+" Kbps"),l+=void 0!==k.transcodedSuffix?", transcoding:"+k.suffix+" > "+k.transcodedSuffix:", "+k.suffix,i=void 0!==k.transcodedSuffix?k.transcodedSuffix:k.suffix,"ogg"==i&&(i="oga");var o=Math.floor(1e5*Math.random());return c=b.BaseURL()+"/stream.view?"+b.BaseParams()+"&id="+k.id+"&salt="+o,new d.Song(k.id,k.parent,g,e,f,k.artistId,k.album,k.albumId,m,n,k.duration,k.userRating,h,i,l,c,0,j)},this.mapSongs=function(a){var b=[],c=this.mapSong;return angular.forEach(a,function(a){b.push(c(a))}),b},this.mapPlaylist=function(a){return new d.Artist(a.id,a.name)},this.mapPodcast=function(a){var c,e,f,g,h,i,j,k,l=a,m="",n="",o="";"undefined"!=typeof l.coverArt&&(n=b.BaseURL()+"/getCoverArt.view?"+b.BaseParams()+"&size=60&id="+l.coverArt,o=b.BaseURL()+"/getCoverArt.view?"+b.BaseParams()+"&id="+l.coverArt),j="undefined"==typeof l.album?"&nbsp;":l.album.toString(),i="undefined"==typeof l.artist?"&nbsp;":l.artist.toString(),k="undefined"==typeof l.title?"&nbsp;":l.title.toString(),h="undefined"==typeof l.description?"":l.description,e="undefined"==typeof l.track?"&nbsp;":l.track.toString(),f="undefined"!=typeof l.starred?!0:!1,void 0!==l.bitRate&&(m+=l.bitRate+" Kbps"),m+=void 0!==l.transcodedSuffix?", transcoding:"+l.suffix+" > "+l.transcodedSuffix:", "+l.suffix,g=void 0!==l.transcodedSuffix?l.transcodedSuffix:l.suffix,"ogg"==g&&(g="oga");var p=Math.floor(1e5*Math.random());return c=b.BaseURL()+"/stream.view?"+b.BaseParams()+"&id="+l.streamId+"&salt="+p,new d.Song(l.streamId,l.parent,e,k,i,l.artistId,j,l.albumId,n,o,l.duration,l.userRating,f,g,m,c,0,h)},this.mapPodcasts=function(a){var b=[],c=this.mapPodcast;return angular.forEach(a,function(a){b.push(c(a))}),b}}]),angular.module("jamstash.utils",["jamstash.settings.service"]).service("utils",["$rootScope","globals",function(a,b){this.safeApply=function(b){var c=a.$root.$$phase;"$apply"===c||"$digest"===c?b&&"function"==typeof b&&b():this.$apply(b)},this.setValue=function(a,c){try{localStorage.setItem(a,JSON.stringify(c))}catch(d){b.settings.Debug&&console.log(d)}},this.getValue=function(a){try{var c=localStorage.getItem(a);return""!==c&&"undefined"!=typeof c?JSON.parse(c):!1}catch(d){b.settings.Debug&&console.log(d)}},this.sortDateFunction=function(a,b){return a.date<b.date?1:-1},this.sortArtistFunction=function(a,b){return a.artist.toLowerCase()<b.artist.toLowerCase()?-1:1},this.sortAlbumFunction=function(a,b){return a.name.toLowerCase()<b.name.toLowerCase()?-1:1},this.sortTrackFunction=function(a,b){return parseInt(a.track)>parseInt(b.track)?-1:1},this.confirmDelete=function(a){var b=window.confirm(a);return b?!0:!1},this.HexEncode=function(a){for(var b="0123456789abcdef",c=[],d=[],e=0;256>e;e++)c[e]=b.charAt(e>>4)+b.charAt(15&e);for(e=0;e<a.length;e++)d[e]=c[a.charCodeAt(e)];return d.join("")},this.switchTheme=function(a){switch(a.toLowerCase()){case"dark":$("link[data-name=theme]").attr("href","styles/Dark.89f86ae3.css");break;case"default":$("link[data-name=theme]").attr("href","")}},this.timeToSeconds=function(a){var b,c=a.split(":");switch(c.length){case 1:b=0;break;case 2:b=60*parseInt(c[0])+parseInt(c[1]);break;case 3:b=60*parseInt(c[0])*60+60*parseInt(c[1])+parseInt(c[2])}return b},this.secondsToTime=function(a){for(var b,c=new Array(3600,60,1),d="",e=0;e<c.length;e++)b=Math.floor(a/c[e]),1>b?b="00":10>b&&(b="0"+b),0===e&&"00"===b||(d+=b,2>e&&(d+=":")),a%=c[e];return d},this.formatDate=function(a,b){var c=angular.isDate(a)?a:new Date(a);return $.format.date(c,b)},this.logObjectProperties=function(a){$.each(a,function(a,b){var c=a;"object"==typeof b?$.each(b,function(a,b){console.log(c+" > "+a+" : "+b)}):console.log(a+" : "+b)})},this.findKeyForCode=function(a){var b={keymap:[{key:"a",code:65},{key:"b",code:66},{key:"c",code:67},{key:"d",code:68},{key:"e",code:69},{key:"f",code:70},{key:"g",code:71},{key:"h",code:72},{key:"i",code:73},{key:"j",code:74},{key:"k",code:75},{key:"l",code:76},{key:"m",code:77},{key:"n",code:78},{key:"o",code:79},{key:"p",code:80},{key:"q",code:81},{key:"r",code:82},{key:"s",code:83},{key:"t",code:84},{key:"u",code:85},{key:"v",code:86},{key:"w",code:87},{key:"x",code:88},{key:"y",code:89},{key:"z",code:90}]},c=0;return $.each(b.keymap,function(b,d){d.code===a&&(c=d.key)}),c},this.toHTML={on:function(a){for(var b=[],c=0;c<a.length;)b[c]=a.charCodeAt(c++);return"&#"+b.join(";&#")+";"},un:function(a){return a.replace(/&#(x)?([^;]{1,5});?/g,function(a,b,c){return String.fromCharCode(parseInt(c,b?16:10))})}},this.parseVersionString=function(a){if("string"!=typeof a)return!1;var b=a.split("."),c=parseInt(b[0])||0,d=parseInt(b[1])||0,e=parseInt(b[2])||0;return{major:c,minor:d,patch:e}},this.checkVersion=function(a,b){return void 0===b?!0:(angular.isObject(a)||(a=this.parseVersionString(a)),angular.isObject(b)||(b=this.parseVersionString(b)),void 0!==b.major&&void 0!==a.major&&a.major>b.major?!0:void 0!==b.minor&&void 0!==a.minor&&a.minor>b.minor?!0:void 0!==b.patch&&void 0!==a.patch&&a.patch>=b.patch?!0:!1)},this.checkVersionNewer=function(a,b){return void 0===b?!0:(angular.isObject(a)||(a=this.parseVersionString(a)),angular.isObject(b)||(b=this.parseVersionString(b)),void 0!==b.major&&void 0!==a.major&&a.major>b.major?!0:void 0!==b.minor&&void 0!==a.minor&&a.minor>b.minor?!0:void 0!==b.patch&&void 0!==a.patch&&a.patch>b.patch?!0:!1)}}]),angular.module("jamstash.page",["jamstash.settings.service","jamstash.utils"]).factory("Page",["$interval","globals","utils",function(a,b,c){var d,e="Jamstash";return{title:function(){return e},setTitle:function(a){return e=a,this},setTitleSong:function(a){return e=void 0!==a.artist&&void 0!==a.name?c.toHTML.un(a.artist)+" - "+c.toHTML.un(a.name):"Jamstash",b.settings.ScrollTitle&&this.scrollTitle(),this},scrollTitle:function(){var b={left:function(a){a.push(a.shift())},right:function(a){a.unshift(a.pop())}},c={text:e,dir:"left",speed:1200},f=c.text.split("");return f?(f.push(" "),void 0!==d&&a.cancel(d),d=a(function(){var a=b[c.dir];a&&(a(f),e=f.join(""))},c.speed),this):void 0}}}]),angular.module("jamstash.notifications",["jamstash.player.service","jamstash.utils"]).service("notifications",["$rootScope","$window","$interval","globals","player","utils",function(a,b,c,d,e,f){this.updateMessage=function(b,c){if(""!==b){var e=a.Messages.push(b)-1;$("#messages").fadeIn(),c&&setTimeout(function(){$("#msg_"+e).fadeOut(function(){$(this).remove()})},d.settings.Timeout)}},this.requestPermissionIfRequired=function(){this.isSupported()&&!this.hasPermission()&&window.Notify.requestPermission()},this.hasPermission=function(){return!b.Notify.needsPermission()},this.isSupported=function(){return window.Notify.isSupported()},this.showNotification=function(b){if(this.hasPermission()){var g=new Notify(f.toHTML.un(b.name),{body:f.toHTML.un(b.artist+" - "+b.album),icon:b.coverartthumb,notifyClick:function(){e.nextTrack(),this.close(),a.$apply()}});c(function(){g.close()},d.settings.Timeout),g.show()}else console.log("showNotification: No Permission")}}]),angular.module("jamstash.persistence",["angular-locker","jamstash.settings.service","jamstash.player.service","jamstash.notifications","jamstash.utils"]).config(["lockerProvider",function(a){a.setDefaultDriver("local").setDefaultNamespace(!1).setEventsEnabled(!1)}]).service("persistence",["globals","player","notifications","locker","json","jamstashVersionChangesets","utils",function(a,b,c,d,e,f,g){this.loadTrackPosition=function(){var c=d.get("CurrentSong");c&&b.load(c),a.settings.Debug&&console.log("Current Position Loaded from localStorage: ",c)},this.saveTrackPosition=function(b){d.put("CurrentSong",b),a.settings.Debug&&console.log("Saving Current Position: ",b)},this.deleteTrackPosition=function(){d.forget("CurrentSong"),a.settings.Debug&&console.log("Removing Current Position from localStorage")},this.loadQueue=function(){var e=d.get("CurrentQueue");e&&(b.addSongs(e),b.queue.length>0&&c.updateMessage(b.queue.length+" Saved Song(s)",!0),a.settings.Debug&&console.log("Play Queue Loaded from localStorage: "+b.queue.length+" song(s)"))},this.saveQueue=function(){d.put("CurrentQueue",b.queue),a.settings.Debug&&console.log("Saving Queue: "+b.queue.length+" songs")},this.deleteQueue=function(){d.forget("CurrentQueue"),a.settings.Debug&&console.log("Removing Play Queue from localStorage")},this.getVolume=function(){var a=d.get("Volume");return void 0===a&&(d.put("Volume",1),a=1),a},this.saveVolume=function(a){d.put("Volume",a)},this.deleteVolume=function(){d.forget("Volume")},this.getSettings=function(){var a=this.getVersion(),b=this;return e.getChangeLog(function(c){var d=c[0].version;g.checkVersionNewer(d,a)&&b.upgradeVersion(a,d)}),d.get("Settings")},this.saveSettings=function(a){d.put("Settings",a)},this.deleteSettings=function(){d.forget("Settings")},this.getVersion=function(){return d.get("JamstashVersion")},this.upgradeVersion=function(a,b){var e=d.get("Settings"),h=_(f.versions).filter(function(c){var d=g.checkVersion(b,c.version),e=g.checkVersionNewer(c.version,a);return d&&e});_(h).each(function(a){a.changeset(e)}),this.saveSettings(e),d.put("JamstashVersion",b),c.updateMessage("Version "+a+" to "+b,!0)}}]).value("jamstashVersionChangesets",{versions:[{version:"4.4.5",changeset:function(a){a.DefaultSearchType=0}}]}),angular.module("JamStash").controller("AppController",["$scope","$rootScope","$document","$window","$location","$cookieStore","$http","utils","globals","model","notifications","player","persistence","Page",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){function o(a){return a&&"INPUT"===a.target.tagName}b.settings=i.settings,b.song=[],b.playingSong=null,b.MusicFolders=[],b.Genres=[],b.Messages=[],b.SelectedMusicFolder="",b.unity=null,a.Page=n,b.loggedIn=function(){return""!==i.settings.Server&&""!==i.settings.Username&&""!==i.settings.Password?!0:!1},b.totalDisplayed=50,b.loadMore=function(){a.totalDisplayed+=50},b.go=function(a){e.path(a)},a.loadSettings=function(){f.get("Settings")&&(m.saveSettings(f.get("Settings")),f.remove("Settings"));var a=m.getSettings();if(void 0!==a){var b=_(a).omit("Url");_(b).each(function(a,b){i.settings[b]=a})}h.getValue("SavedCollections")&&(i.SavedCollections=h.getValue("SavedCollections").split(",")),h.getValue("DefaultCollection")&&(i.DefaultCollection=h.getValue("DefaultCollection")),h.getValue("SavedGenres")&&(i.SavedGenres=h.getValue("SavedGenres").split(",")),i.settings.Debug&&console.log("Loaded Settings: "+JSON.stringify(i.settings,null,2))},a.toggleSetting=function(a){var b=a;i.settings[b]?i.settings[b]=!1:i.settings[b]=!0,k.updateMessage(a+" : "+i.settings[b],!0)},$.ajaxSetup({beforeSend:function(){$("#loading").show()},complete:function(){$("#loading").hide()}});var p=!1;$("div.submenu").mouseenter(function(){p=!0}),$("div.submenu").mouseleave(function(){p=!1,$("div.submenu").hide()}),a.toggleSubmenu=function(a,b,c,d){var e=$(a);if("none"!==e.css("display"))e.fadeOut();else{{var f=$(b),g=f.offset();f.width(),f.height()}switch(c){case"right":e.css({left:g.left+d+"px",top:g.top+"px"}).fadeIn(400);break;case"left":e.css({left:g.left-d+"px",top:g.top+"px"}).fadeIn(400)}setTimeout(function(){p===!1&&$("div.submenu").stop().fadeOut()},1e4)}},a.$watchCollection(function(){return l.queue},function(b){void 0!==b&&b.length>0&&i.settings.ShowQueue&&a.showQueue()}),b.showQueue=function(){$("#SideBar").css("display","block"),$("#right-component").removeClass("lgcolumn_expanded")},b.hideQueue=function(){$("#SideBar").css("display","none"),$("#right-component").addClass("lgcolumn_expanded")},a.toggleQueue=function(){"none"===$("#SideBar").css("display")?b.showQueue():b.hideQueue()},b.showArtists=function(){$("#left-component").css("display",""),$("#right-component").removeClass("lgcolumn_expandedleft")},b.hideArtists=function(){$("#left-component").css("display","none"),$("#right-component").addClass("lgcolumn_expandedleft")},a.toggleArtists=function(){"none"==$("#left-component").css("display")?b.showArtists():b.hideArtists()},a.fancyboxOpenImage=function(a){$.fancybox.open({helpers:{overlay:{css:{background:"rgba(0, 0, 0, 0.15)"}}},hideOnContentClick:!0,type:"image",openEffect:"none",closeEffect:"none",href:a})},$(document).on("click",".message",function(){$(this).remove()}),window.onbeforeunload=function(){return!i.settings.Debug&&l.queue.length>0?"You're about to end your session, are you sure?":void 0},b.showIndex=!1,$(document).on("click","message",function(){return $(this).fadeOut(function(){$(this).remove()}),!1}),c.keydown(function(b){a.scrollToIndex(b)}),a.scrollToIndex=function(a){a.target.id;if("INPUT"!=a.target.tagName.toUpperCase()){var b=a.charCode?a.charCode:a.keyCode;if(i.settings.Debug&&console.log("Keycode Triggered: "+b),49==b?$("#action_Queue").click():50==b?$("#action_Library").click():51==b?$("#action_Archive").click():52==b&&$("#action_Settings").click(),b>=65&&90>=b&&$("#tabLibrary").is(":visible")){var c=h.findKeyForCode(b);("x"==c||"y"==c||"z"==c)&&(c="x-z");var d="#"+c.toUpperCase();$(d).length>0&&$("#left-component").stop().scrollTo(d,400)}else 36==b&&$("#tabLibrary").is(":visible")&&$("#left-component").stop().scrollTo("#MusicFolders",400)}return!0},a.scrollToIndexName=function(a){var b="#"+a;$(b).length>0&&$("#left-component").stop().scrollTo(b,400)},a.scrollToTop=function(){$("#left-component").stop().scrollTo("#MusicFolders",400)},b.selectAll=function(b){angular.forEach(b,function(b,c){a.selectedSongs.push(b),b.selected=!0})},b.selectNone=function(b){angular.forEach(b,function(b,c){a.selectedSongs=[],b.selected=!1})},b.playAll=function(a){l.queue=[],b.selectAll(a),b.addSongsToQueue();var c=l.queue[0];l.play(c)},b.playFrom=function(c,d){var e=d.slice(c,d.length);if(a.selectedSongs=[],angular.forEach(e,function(b,c){a.selectedSongs.push(b),b.selected=!0}),a.selectedSongs.length>0){l.queue=[],b.addSongsToQueue();var f=l.queue[0];l.play(f)}},b.addSongsToQueue=function(){0!==a.selectedSongs.length&&(angular.forEach(a.selectedSongs,function(a,b){l.queue.push(a),a.selected=!1}),k.updateMessage(a.selectedSongs.length+" Song(s) Added to Queue",!0),a.selectedSongs.length=0)},b.removeSong=function(a,b){var c=b.indexOf(a);b.splice(c,1)},a.isActive=function(a){return a===e.path()},b.getSplitPosition=function(a,b){window.alert(b.getBoundingClientRect().left)},a.download=function(a){$.ajax({url:i.BaseURL()+"/getUser.view?"+i.BaseParams()+"&username="+i.settings.Username,method:"GET",dataType:i.settings.Protocol,timeout:i.settings.Timeout,success:function(b){"undefined"!=typeof b["subsonic-response"].error?k.updateMessage("Error: "+b["subsonic-response"].error.message,!0):b["subsonic-response"].user.downloadRole===!0?d.location.href=i.BaseURL()+"/download.view?"+i.BaseParams()+"&id="+a:k.updateMessage("You do not have permission to Download",!0)}})},a.selectedSongs=[],a.selectSong=function(b){var c=a.selectedSongs.indexOf(b);c>=0?(a.selectedSongs.splice(c,1),b.selected=!1):(a.selectedSongs.push(b),b.selected=!0)},a.togglePause=function(b){o(b)||(i.settings.Jukebox?a.sendToJukebox("stop"):l.togglePause())},a.turnVolumeUp=function(a){if(!o(a)){var b=l.turnVolumeUp();m.saveVolume(b)}},a.turnVolumeDown=function(a){if(!o(a)){var b=l.turnVolumeDown();m.saveVolume(b)}},a.nextTrack=function(a){o(a)||l.nextTrack()},a.previousTrack=function(a){o(a)||l.previousTrack()},b.addToJukebox=function(a){i.settings.Debug&&console.log("LOAD JUKEBOX"),$.ajax({url:i.BaseURL()+"/jukeboxControl.view?"+i.BaseParams()+"&action=set&id="+a,method:"GET",dataType:i.settings.Protocol,timeout:i.settings.Timeout,success:function(a){$.get(i.BaseURL()+"/jukeboxControl.view?"+i.BaseParams()+"&action=start")}})},b.sendToJukebox=function(a){i.settings.Debug&&console.log("SEND JUKEBOX "+a),$.ajax({url:i.BaseURL()+"/jukeboxControl.view?"+i.BaseParams()+"&action="+a,method:"GET",dataType:i.settings.Protocol,timeout:i.settings.Timeout,success:function(a){}})},a.updateFavorite=function(a){var b,c=a.id,d=a.starred;d?(b=i.BaseURL()+"/unstar.view?"+i.BaseParams()+"&id="+c,a.starred=void 0):(b=i.BaseURL()+"/star.view?"+i.BaseParams()+"&id="+c,a.starred=!0),$.ajax({url:b,method:"GET",dataType:i.settings.Protocol,timeout:i.settings.Timeout,success:function(){k.updateMessage("Favorite Updated!",!0)}})},a.toTrusted=function(a){return $sce.trustAsHtml(a)},a.loadSettings(),h.switchTheme(i.settings.Theme),i.settings.ShowQueue||b.hideQueue(),a.loggedIn()&&(i.settings.SaveTrackPosition&&(m.loadQueue(),m.loadTrackPosition()),l.setVolume(m.getVolume()))}]),angular.module("jamstash.subsonic.controller",["jamstash.subsonic.service","jamstash.player.service"]).controller("SubsonicController",["$scope","$rootScope","$routeParams","$window","utils","globals","map","subsonic","notifications","player",function(a,b,c,d,e,f,g,h,i,j){a.settings=f.settings,a.itemType="ss",a.Server=f.settings.Server,a.playlistMenu=[],a.AutoAlbums=[{id:"random",name:"Random"},{id:"newest",name:"Recently Added"},{id:"starred",name:"Starred"},{id:"highest",name:"Top Rated"},{id:"frequent",name:"Most Played"},{id:"recent",name:"Recently Played"}],a.SelectedAlbumSort=f.settings.DefaultAlbumSort,a.AlbumSort=f.AlbumSorts,b.showIndex=h.showIndex,a.$watch("showIndex",function(a,c){a!==c&&(h.showIndex=b.showIndex)}),a.toggleIndex=function(){b.showIndex?b.showIndex=!1:(b.showIndex=!0,a.showPlaylist=!1,a.showPodcast=!1),a.saveDefaultSection("index")},a.showPlaylist=h.showPlaylist,a.$watch("showPlaylist",function(b,c){b!==c&&(h.showPlaylist=a.showPlaylist)}),a.togglePlaylist=function(){a.showPlaylist?a.showPlaylist=!1:(a.showPlaylist=!0,b.showIndex=!1,a.showPodcast=!1),a.saveDefaultSection("playlist")},a.showPodcast=h.showPodcast,a.$watch("showPodcast",function(b,c){b!==c&&(h.showPodcast=a.showPodcast)}),a.togglePodcast=function(){a.showPodcast?a.showPodcast=!1:(a.showPodcast=!0,a.showPlaylist=!1,b.showIndex=!1),a.saveDefaultSection("podcast")},a.saveDefaultSection=function(a){e.setValue("DefaultSection",a,!1)},a.openDefaultSection=function(){var c=e.getValue("DefaultSection");switch(c){case"index":b.showIndex=!0;break;case"playlist":a.showPlaylist=!0;break;case"podcast":a.showPodcast=!0}};var k=function(b){if("undefined"!=typeof b)switch(b){case"createdate desc":a.album.sort(e.sortDateFunction);break;case"artist":a.album.sort(e.sortArtistFunction);break;case"album":a.album.sort(e.sortAlbumFunction)}},l=function(b){if("undefined"!=typeof b)switch(b){case"createdate desc":a.song.sort(e.sortDateFunction);break;case"artist":a.song.sort(e.sortArtistFunction);break;case"album":a.song.sort(e.sortAlbumFunction);break;case"track":a.song.sort(e.sortTrackFunction)}};a.$watch("SelectedAlbumSort.id",function(b,c){if(b!==c)if(a.song.length>0)l(b);else if(a.album.length>0){k(b);var d=$.map(f.AlbumSorts,function(a,c){return a.id===b?c:void 0});f.settings.DefaultAlbumSort=f.AlbumSorts[d]}}),b.$watch("SelectedMusicFolder",function(b,c){b!==c&&(e.setValue("MusicFolders",angular.toJson(b),!0),a.getArtists(b.id))}),a.searching={query:"",typeId:f.settings.DefaultSearchType,types:f.SearchTypes},a.playlistsGenre=f.SavedGenres,a.$watch("selectedGenre",function(a,b){a!==b&&(f.SavedGenres.push(a),e.setValue("SavedGenres",f.SavedGenres.join(),!1))}),a.rescanLibrary=function(a,b){$.ajax({url:f.BaseURL()+"/getUser.view?"+f.BaseParams()+"&username="+f.settings.Username,method:"GET",dataType:f.settings.Protocol,timeout:f.settings.Timeout,success:function(a){a["subsonic-response"].user.adminRole===!0?$.get(f.settings.Server+"/musicFolderSettings.view?scanNow&"+f.BaseParams()):alert("You are not logged in as an admin user!")}})},a.selectAll=function(){b.selectAll(a.song)},a.selectNone=function(){b.selectNone(a.song)},a.playAll=function(){b.playAll(a.song)},a.playFrom=function(c){b.playFrom(c,a.song)},a.removeSong=function(c){b.removeSong(c,a.song)},a.songsRemoveSelected=function(){h.songsRemoveSelected(a.selectedSongs).then(function(b){a.album=b.album,a.song=b.song})},a.getArtists=function(b){var c=h.getArtists(b);a.handleErrors(c).then(function(b){a.index=b.index,a.shortcut=b.shortcut},function(b){a.index=[],a.shortcut=[],b.serviceError===!0&&i.updateMessage(b.reason,!0)})},a.refreshArtists=function(){e.setValue("MusicFolders",null,!0),a.getArtists(),a.getPlaylists()},a.getAlbums=function(b,c){h.getAlbums(b,c).then(function(b){a.album=b.album,a.song=b.song,a.BreadCrumbs=b.breadcrumb,a.selectedAutoAlbum=b.selectedAutoAlbum,a.selectedArtist=b.selectedArtist,a.selectedAlbum=b.selectedAlbum,a.selectedPlaylist=b.selectedPlaylist,"default"!=a.SelectedAlbumSort.id&&k(a.SelectedAlbumSort.id)})},a.getAlbumListBy=function(b,c){h.getAlbumListBy(b,c).then(function(b){a.album=b.album,a.song=b.song,a.BreadCrumbs=b.breadcrumb,a.selectedAutoAlbum=b.selectedAutoAlbum,a.selectedArtist=b.selectedArtist,a.selectedPlaylist=b.selectedPlaylist,"default"!=a.SelectedAlbumSort.id&&k(a.SelectedAlbumSort.id)})},a.handleErrors=function(a){return a.then(null,function(a){var b;void 0!==a.subsonicError?b=a.reason+" "+a.subsonicError.message:void 0!==a.httpError?b=a.reason+" HTTP error "+a.httpError:a.serviceError=!0,(void 0!==a.subsonicError||void 0!==a.httpError)&&i.updateMessage(b,!0)}),a},a.requestSongs=function(b,c){return a.handleErrors(b).then(function(b){"play"===c?(j.emptyQueue().addSongs(b).playFirstSong(),i.updateMessage(b.length+" Song(s) Added to Queue",!0)):"add"===c?(j.addSongs(b),i.updateMessage(b.length+" Song(s) Added to Queue",!0)):"display"===c&&(a.album=[],a.song=b)},function(a){a.serviceError===!0&&i.updateMessage(a.reason,!0)}),b},a.getSongs=function(b,c){h.getSongs(b,c).then(function(b){a.album=b.album,a.song=b.song,a.BreadCrumbs=b.breadcrumb,a.selectedAutoAlbum=b.selectedAutoAlbum,a.selectedArtist=b.selectedArtist,a.selectedPlaylist=b.selectedPlaylist,"default"!=a.SelectedAlbumSort.id&&k(a.SelectedAlbumSort.id)})},a.getRandomStarredSongs=function(b){var c=h.getRandomStarredSongs();a.requestSongs(c,b),a.album=[],a.BreadCrumbs=null,a.selectedAutoAlbum=null,a.selectedArtist=null,a.selectedAlbum=null,a.selectedAutoPlaylist="starred",a.selectedPlaylist=null,a.selectedPodcast=null},a.getRandomSongs=function(b,c,d){var e=h.getRandomSongs(c,d);a.requestSongs(e,b),isNaN(d)?void 0!==c&&""!==c&&"Random"!==c?a.selectedAutoPlaylist=c:a.selectedAutoPlaylist="random":a.selectedAutoPlaylist=d,a.album=[],a.BreadCrumbs=null,a.selectedAutoAlbum=null,a.selectedArtist=null,a.selectedAlbum=null,a.selectedPlaylist=null,a.selectedPodcast=null},a.getStarred=function(b,c){h.getStarred(b,c).then(function(b){a.album=b.album,a.song=b.song,a.selectedAutoPlaylist=b.selectedAutoPlaylist,a.selectedPlaylist=b.selectedPlaylist})},a.getArtistByTag=function(b){a.selectedAutoAlbum=null,a.selectedArtist=b;var c=f.BaseURL()+"/getArtist.view?"+f.BaseParams()+"&id="+b;$.ajax({url:c,method:"GET",dataType:f.settings.Protocol,timeout:f.settings.Timeout,success:function(b){var c=[];"undefined"!=typeof b["subsonic-response"].artist?(b["subsonic-response"].artist.album.length>0?c=b["subsonic-response"].artist.album:c[0]=b["subsonic-response"].artist.album,h.content.album=[],h.song=[],angular.forEach(c,function(a){h.content.album.push(g.mapAlbum(a))}),a.$apply()):i.updateMessage("No Albums Returned :(",!0)}})},a.getAlbumByTag=function(b){h.getAlbumByTag(b).then(function(b){a.album=b.album,a.song=b.song,a.BreadCrumbs=b.breadcrumb,a.selectedAutoAlbum=b.selectedAutoAlbum,a.selectedArtist=b.selectedArtist,a.selectedPlaylist=b.selectedPlaylist})},a.search=function(b,c){if(b&&b.length>0){var d=h.search(b,c);a.handleErrors(d).then(function(b){0===c?(a.song=b,a.album=[]):1===c?(a.song=[],a.album=b):2===c&&(a.song=[],a.album=[],a.shortcut=b),a.BreadCrumbs=null},function(a){a.serviceError===!0&&i.updateMessage(a.reason,!0)})}},a.toggleAZ=function(){a.toggleSubmenu("#submenu_AZIndex","#AZIndex","right",44);

},a.getPlaylists=function(){var b=h.getPlaylists();a.handleErrors(b).then(function(b){a.playlists=b.playlists,a.playlistsPublic=b.playlistsPublic},function(){a.playlists=[],a.playlistsPublic=[]})},a.getPlaylist=function(b,c){var d=h.getPlaylist(c);a.requestSongs(d,b).then(function(a){"display"===b&&i.updateMessage(a.length+" Song(s) in Playlist",!0)}),a.song=[],a.album=[],a.BreadCrumbs=null,a.selectedAutoAlbum=null,a.selectedArtist=null,a.selectedAlbum=null,a.selectedAutoPlaylist=null,a.selectedPlaylist=c,a.selectedPodcast=null},a.newPlaylist=function(){var b=d.prompt("Choose a name for your new playlist.","");if(null!==b&&""!==b&&"null"!==b){var c=h.newPlaylist(b);a.handleErrors(c).then(function(){a.getPlaylists()})}},a.deletePlaylist=function(){if(null!==a.selectedPlaylist){var b=d.confirm("Are you sure you want to delete the selected playlist?");if(b){var c=h.deletePlaylist(a.selectedPlaylist);a.handleErrors(c).then(function(){a.getPlaylists()})}}else i.updateMessage("Please select a playlist to delete.")},a.savePlaylist=function(){if(null!==a.selectedPlaylist){var b=h.savePlaylist(a.selectedPlaylist,a.song);a.handleErrors(b).then(function(){a.getPlaylist("display",a.selectedPlaylist),i.updateMessage("Playlist Updated!",!0)})}else i.updateMessage("Please select a playlist to save.")},a.loadPlaylistsForMenu=function(b,c){$.ajax({url:f.BaseURL()+"/getPlaylists.view?"+f.BaseParams(),method:"GET",dataType:f.settings.Protocol,timeout:f.settings.Timeout,success:function(b){var c=[];a.playlistMenu=[],"undefined"!=typeof b["subsonic-response"].playlists.playlist&&(b["subsonic-response"].playlists.playlist.length>0?c=b["subsonic-response"].playlists.playlist:c[0]=b["subsonic-response"].playlists.playlist,angular.forEach(c,function(b,c){b.owner==f.settings.Username&&a.playlistMenu.push(g.mapPlaylist(b))}),a.playlistMenu.length>0?(a.$apply(),a.toggleSubmenu("#submenu_AddToPlaylist","#action_AddToPlaylist","left",124)):i.updateMessage("No Playlists :(",!0))}})},a.addToPlaylist=function(b){var c=[];if(0!==a.selectedSongs.length){angular.forEach(a.selectedSongs,function(a){c.push(a.id)});var d=e.parseVersionString(f.settings.ApiVersion),g=e.parseVersionString("1.8.0");e.checkVersion(d,g)&&$.ajax({type:"GET",url:f.BaseURL()+"/updatePlaylist.view?"+f.BaseParams(),dataType:f.settings.Protocol,timeout:f.settings.Timeout,data:{playlistId:b,songIdToAdd:c},success:function(b){a.selectedSongs.length=0,i.updateMessage("Playlist Updated!",!0)},traditional:!0})}},a.getGenres=function(){h.getGenres().then(function(b){a.Genres=b})},a.getPodcasts=function(){var b=h.getPodcasts();a.handleErrors(b).then(function(b){a.podcasts=b},function(){a.podcasts=[]})},a.getPodcast=function(b,c){var d=h.getPodcast(c);a.requestSongs(d,b),a.song=[],a.album=[],a.BreadCrumbs=null,a.selectedAutoAlbum=null,a.selectedArtist=null,a.selectedAlbum=null,a.selectedAutoPlaylist=null,a.selectedPlaylist=null,a.selectedPodcast=c},a.getMusicFolders=function(){$.ajax({url:f.BaseURL()+"/getMusicFolders.view?"+f.BaseParams(),method:"GET",dataType:f.settings.Protocol,timeout:f.settings.Timeout,success:function(c){if(void 0!==c["subsonic-response"].musicFolders.musicFolder){var d=[];if(c["subsonic-response"].musicFolders.musicFolder.length>0?d=c["subsonic-response"].musicFolders.musicFolder:d[0]=c["subsonic-response"].musicFolders.musicFolder,d.unshift({id:-1,name:"All Folders"}),b.MusicFolders=d,e.getValue("MusicFolders")){var f=angular.fromJson(e.getValue("MusicFolders")),g=0,h="";angular.forEach(b.MusicFolders,function(a,b){a.id==f.id&&(h=g),g++}),b.SelectedMusicFolder=b.MusicFolders[h]}else b.SelectedMusicFolder=b.MusicFolders[0];a.$apply()}}})},a.dragStart=function(a,b){b.item.data("start",b.item.index())},a.dragEnd=function(b,c){var d=c.item.data("start"),e=c.item.index();a.song.splice(e,0,a.song.splice(d,1)[0])},a.playSong=function(a){j.play(a)},a.addSongToQueue=function(a){j.addSong(a)},a.getArtists(),a.getPlaylists(),a.getGenres(),a.getPodcasts(),a.openDefaultSection(),a.getMusicFolders(),c.artistId&&c.albumId?a.getAlbumByTag(c.albumId):c.artistId&&a.getAlbums(c.artistId)}]),angular.module("jamstash.subsonic.service",["angular-underscore/utils","jamstash.settings.service","jamstash.utils","jamstash.model","jamstash.notifications","jamstash.player.service"]).factory("subsonic",["$rootScope","$http","$q","globals","utils","map","notifications","player",function(a,b,c,d,e,f,g,h){var i={album:[],song:[],playlists:[],breadcrumb:[],playlistsPublic:[],playlistsGenre:d.SavedGenres,selectedAutoAlbum:null,selectedArtist:null,selectedAlbum:null,selectedPlaylist:null,selectedAutoPlaylist:null,selectedGenre:null,selectedPodcast:null},j=[],k=0,l=!1;return{showIndex:a.showIndex,showPlaylist:l,getSongTemplate:function(a){var c="16608",e=d.BaseURL()+"/getMusicDirectory.view?"+d.BaseParams()+"&id="+c;b.get(e).success(function(b){var c=[],d=[];"undefined"!=typeof b["subsonic-response"].directory.child&&(b["subsonic-response"].directory.child.length>0?c=b["subsonic-response"].directory.child:c[0]=b["subsonic-response"].directory.child,angular.forEach(c,function(a,b){a.isDir||d.push(f.mapSong(a))}),a(d))})},subsonicRequest:function(a,e){var f={reason:"Error when contacting the Subsonic server."},g=c.defer(),h="/"===a.charAt(0)?a:"/"+a,i=d.BaseURL()+h,j=e||{},k=j.params||{};k.u=d.settings.Username,k.p=d.settings.Password,k.f=d.settings.Protocol,k.v=d.settings.ApiVersion,k.c=d.settings.ApplicationName,j.params=k,j.timeout=d.settings.Timeout;var l;return"jsonp"===d.settings.Protocol?(j.params.callback="JSON_CALLBACK",l=b.jsonp(i,j)):l=b.get(i,j),l.success(function(a){var b=void 0!==a["subsonic-response"]?a["subsonic-response"]:{status:"failed"};"ok"===b.status?g.resolve(b):("failed"===b.status&&void 0!==b.error&&(f.subsonicError=b.error),g.reject(f))}).error(function(a,b){f.httpError=b,g.reject(f)}),g.promise},ping:function(){return this.subsonicRequest("ping.view")},getArtists:function(a){var b={reason:"No artist found on the Subsonic server."};if(isNaN(a)&&e.getValue("MusicFolders")){var d=angular.fromJson(e.getValue("MusicFolders"));a=d.id}var f;isNaN(a)||(f={musicFolderId:a});var g=this.subsonicRequest("getIndexes.view",{params:f}).then(function(a){if(void 0===a.indexes||void 0===a.indexes.index&&void 0===a.indexes.shortcut)return c.reject(b);var d={};return d.shortcut=[].concat(a.indexes.shortcut),d.index=[].concat(a.indexes.index),_(d.index).map(function(a){var b=a;return b.artist=[].concat(a.artist),b}),d});return g},getAlbums:function(a,b){var d={reason:"No songs found on the Subsonic server."},e={id:a},g=this.subsonicRequest("getMusicDirectory.view",{params:e}).then(function(e){if(void 0!==e.directory.child){var g=[].concat(e.directory.child);if(g.length>0)return i.song=[],i.album=[],i.breadcrumb=[],i.breadcrumb.push({type:"artist",id:a,name:b}),angular.forEach(g,function(a,b){a.isDir?i.album.push(f.mapAlbum(a)):i.song.push(f.mapSong(a))}),i}return c.reject(d)});return g},getAlbumListBy:function(a,b){"next"==b?k+=d.settings.AutoAlbumSize:"prev"==b?k-=d.settings.AutoAlbumSize:k=0;var e={reason:"No songs found on the Subsonic server."},g={size:d.settings.AutoAlbumSize,type:a,offset:k},h=this.subsonicRequest("getAlbumList.view",{params:g}).then(function(b){if(void 0!==b.albumList.album){var d=[].concat(b.albumList.album);if(d.length>0)return i.song=[],i.album=[],i.selectedArtist=null,i.selectedPlaylist=null,i.selectedAutoAlbum=a,i.breadcrumb=[],angular.forEach(d,function(a,b){a.isDir?i.album.push(f.mapAlbum(a)):i.song.push(f.mapSong(a))}),i}return c.reject(e)});return h},getAlbumByTag:function(a){var b=c.defer();return $.ajax({url:d.BaseURL()+"/getAlbum.view?"+d.BaseParams()+"&id="+a,method:"GET",dataType:d.settings.Protocol,timeout:d.settings.Timeout,success:function(a){if("undefined"!=typeof a["subsonic-response"].album){i.album=[],i.song=[];var c=[];a["subsonic-response"].album.song.length>0?c=a["subsonic-response"].album.song:c[0]=a["subsonic-response"].album.song,angular.forEach(c,function(a,b){i.song.push(f.mapSong(a))})}b.resolve(i)}}),b.promise},getSongs:function(a,b){var d={reason:"No songs found on the Subsonic server."},e=this.subsonicRequest("getMusicDirectory.view",{params:{id:a}}).then(function(e){if(void 0!==e.directory.child){var j=[].concat(e.directory.child);if(j.length>0){if(i.selectedAlbum=a,"add"==b)angular.forEach(j,function(a,b){h.queue.push(f.mapSong(a))}),g.updateMessage(j.length+" Song(s) Added to Queue",!0);else if("play"==b){h.queue=[],angular.forEach(j,function(a,b){h.queue.push(f.mapSong(a))});var k=h.queue[0];h.play(k),g.updateMessage(j.length+" Song(s) Added to Queue",!0)}else{if("undefined"!=e.directory.id){var l=e.directory.id,m=e.directory.name;i.breadcrumb.length>0&&i.breadcrumb.splice(1,i.breadcrumb.length-1),i.breadcrumb.push({type:"album",id:l,name:m})}i.song=[],i.album=[];var n=[];angular.forEach(j,function(a,b){a.isDir?n.push(f.mapAlbum(a)):i.song.push(f.mapSong(a))}),n.length>0&&(i.album=n)}return i}}return c.reject(d)});return e},search:function(a,b){if(_([0,1,2]).contains(b)){var d=this.subsonicRequest("search2.view",{params:{query:a}}).then(function(a){if(!_.isEmpty(a.searchResult2))switch(b){case 0:if(void 0!==a.searchResult2.song)return f.mapSongs([].concat(a.searchResult2.song));break;case 1:if(void 0!==a.searchResult2.album)return f.mapAlbums([].concat(a.searchResult2.album));break;case 2:if(void 0!==a.searchResult2.artist)return[].concat(a.searchResult2.artist)}return c.reject({reason:"No results."})});return d}return c.reject({reason:"Wrong search type."})},getRandomSongs:function(a,b){var e={reason:"No songs found on the Subsonic server."},g={size:d.settings.AutoPlaylistSize};void 0!==a&&""!==a&&"Random"!==a&&(g.genre=a),isNaN(b)||(g.musicFolderId=b);var h=this.subsonicRequest("getRandomSongs.view",{params:g}).then(function(a){if(void 0!==a.randomSongs){var b=[].concat(a.randomSongs.song);if(b.length>0)return f.mapSongs(b)}return c.reject(e)});return h},getStarred:function(){var a=this.subsonicRequest("getStarred.view",{cache:!0}).then(function(a){return angular.equals(a.starred,{})?c.reject({reason:"Nothing is starred on the Subsonic server."}):a.starred});return a},getRandomStarredSongs:function(){var a=this.getStarred().then(function(a){if(void 0!==a.song){var b=[].concat(a.song);if(b.length>0){var e=[].concat(_(b).sample(d.settings.AutoPlaylistSize));return f.mapSongs(e)}}return c.reject({reason:"No starred songs found on the Subsonic server."})});return a},getPlaylists:function(){var a={reason:"No playlist found on the Subsonic server."},b=this.subsonicRequest("getPlaylists.view").then(function(b){if(void 0!==b.playlists.playlist){var e=[].concat(b.playlists.playlist);if(e.length>0){var f=_(e).partition(function(a){return a.owner===d.settings.Username});return{playlists:f[0],playlistsPublic:f[1]}}}return c.reject(a)});return b},getPlaylist:function(a){var b={reason:"This playlist is empty."},d=this.subsonicRequest("getPlaylist.view",{params:{id:a}}).then(function(a){if(void 0!==a.playlist.entry){var d=[].concat(a.playlist.entry);if(d.length>0)return f.mapSongs(d)}return c.reject(b)});return d},newPlaylist:function(a){var b=this.subsonicRequest("createPlaylist.view",{params:{name:a}});return b},deletePlaylist:function(a){var b=this.subsonicRequest("deletePlaylist.view",{params:{id:a}});return b},savePlaylist:function(a,b){for(var c={params:{playlistId:a,songId:[]}},d=0;d<b.length;d++)c.params.songId.push(b[d].id);return this.subsonicRequest("createPlaylist.view",c)},songsRemoveSelected:function(a){var b=c.defer();return angular.forEach(a,function(a,b){var c=i.song.indexOf(a);i.song.splice(c,1)}),b.resolve(i),b.promise},getGenres:function(){var a=c.defer(),b="Acid Rock,Acoustic,Alt Country,Alt/Indie,Alternative & Punk,Alternative Metal,Alternative,AlternRock,Awesome,Bluegrass,Blues,Blues-Rock,Classic Hard Rock,Classic Rock,Comedy,Country,Country-Rock,Dance,Dance-Rock,Deep Funk,Easy Listening,Electronic,Electronica,Electronica/Dance,Folk,Folk/Rock,Funk,Grunge,Hard Rock,Heavy Metal,Holiday,House,Improg,Indie Rock,Indie,International,Irish,Jam Band,Jam,Jazz Fusion,Jazz,Latin,Live Albums,Metal,Music,Oldies,Other,Pop,Pop/Rock,Post Rock,Progressive Rock,Psychedelic Rock,Psychedelic,Punk,R&B,Rap & Hip-Hop,Reggae,Rock & Roll,Rock,Rock/Pop,Roots,Ska,Soft Rock,Soul,Southern Rock,Thrash Metal,Unknown,Vocal,World";return j=b.split(","),a.resolve(j),a.promise},getPodcasts:function(){var a={reason:"No podcast found on the Subsonic server."},b=this.subsonicRequest("getPodcasts.view",{params:{includeEpisodes:!1}}).then(function(b){if(void 0!==b.podcasts&&void 0!==b.podcasts.channel){var d=[].concat(b.podcasts.channel);if(d.length>0)return d}return c.reject(a)});return b},getPodcast:function(a){var b={reason:"This podcast was not found on the Subsonic server."},d=this.subsonicRequest("getPodcasts.view",{params:{id:a,includeEpisodes:!0}}).then(function(d){var e=[];if(void 0!==d.podcasts.channel){var g=[].concat(d.podcasts.channel);if(g.length>0){var h=g[0];if(null!==h&&h.id===a){var i=[].concat(h.episode);return e=_(i).filter(function(a){return"completed"===a.status}),e.length>0?f.mapPodcasts(e):c.reject({reason:"No downloaded episode found for this podcast. Please check the podcast settings."})}}}return c.reject(b)});return d},scrobble:function(a){var b=this.subsonicRequest("scrobble.view",{params:{id:a.id,submisssion:!0}}).then(function(){return d.settings.Debug&&console.log("Successfully scrobbled song: "+a.id),!0});return b}}}]),angular.module("jamstash.archive.controller",["jamstash.archive.service"]).controller("ArchiveController",["$scope","$rootScope","$location","$routeParams","$http","$timeout","utils","globals","model","notifications","player","archive","json",function(a,b,c,d,e,f,g,h,i,j,k,l,m){a.settings=h.settings,a.itemType="archive",b.song=[],a.Protocol="jsonp",a.artist=[],a.album=[],a.selectedArtist=null,a.selectedAlbum=null,a.selectedSongs=[],a.SavedCollections=h.SavedCollections,a.AllArtists=[],a.loadedCollection=!1,a.writeSavedCollection=function(){g.setValue("SavedCollections",a.SavedCollections.join(),!1),h.SavedCollections=a.SavedCollections},a.addSavedCollection=function(b){if(-1==a.SavedCollections.indexOf(b)){a.SavedCollections.push(b),a.writeSavedCollection();var c=a.AllArtists.indexOf(b);a.AllArtists.splice(c,1)}},a.deleteSavedCollection=function(b){a.SavedCollections.splice(b,1),a.writeSavedCollection()},a.setupDemoCollections=function(){var b=["YonderMountainStringBand","GreenskyBluegrass"];angular.forEach(b,function(b,c){-1==a.SavedCollections.indexOf(b)&&a.SavedCollections.push(b)})},a.selectedArchiveAlbumSort=h.settings.DefaultArchiveAlbumSort,a.ArchiveAlbumSort=["addeddate desc","addeddate asc","avg_rating desc","avg_rating asc","createdate desc","createdate asc","date desc","date asc","downloads desc","downloads asc","num_reviews desc","num_reviews asc","publicdate desc","publicdate asc","stars desc","stars asc"],a.$watch("selectedArchiveAlbumSort",function(b,c){g.getValue("AlbumSort")!=b&&("undefined"!=typeof b?(g.setValue("AlbumSort",b,!0),h.settings.DefaultArchiveAlbumSort=b):g.setValue("AlbumSort",null,!0),a.getAlbums(a.selectedArtist))}),a.getYears=function(a){var b=(new Date).getFullYear(),c=[];for(a=a||1950;b>=a;)c.push(a++);return c},a.Years=a.getYears(),a.filter={Year:"",Source:"",Description:""},a.filterSave=function(){a.selectedArtist&&a.getAlbums(a.selectedArtist,a.filter)},a.getArtists=function(b){var c=$("#Artists").val(),d=$("#Collections option:selected").text();(b||c.length>=3)&&l.getArtists(c,d).then(function(b){a.AllArtists=b.artist,a.loadedCollection=!0})},a.getAlbums=function(b){l.getAlbums(b,a.filter).then(function(b){a.song=b.song,a.album=b.album,a.selectedArtist=b.selectedArtist,a.BreadCrumbs=b.breadcrumb})},a.getSongs=function(b,c){l.getSongs(b,c).then(function(b){a.album=b.album,a.song=b.song,a.selectedAlbum=b.selectedAlbum,a.BreadCrumbs=b.breadcrumb,f(function(){$.fancybox.update()})})},a.scrollToTop=function(){$("#Artists").stop().scrollTo("#auto",400)},a.selectAll=function(){b.selectAll(a.song)},a.selectNone=function(){b.selectNone(a.song)},a.playAll=function(){b.playAll(a.song)},a.playFrom=function(c){b.playFrom(c,a.song)},a.removeSong=function(c){b.removeSong(c,a.song)},a.getAlbums(),d.artist&&(d.album?a.getSongs(d.album):a.getAlbums(d.artist),a.addSavedCollection(d.artist))}]),angular.module("jamstash.archive.service",["jamstash.settings.service","jamstash.model","jamstash.notifications","jamstash.player.service"]).factory("archive",["$rootScope","$http","$q","$sce","globals","model","utils","map","notifications","player",function(a,b,c,d,e,f,g,h,i,j){var k={artist:[],album:[],song:[],breadcrumb:[],selectedArtist:null,selectedAlbum:null,selectedGenre:null,selectedArchiveAlbumSort:"date desc"},l=function(a){var b,c,g,h,i,j,k,l,m,n,o,p=a,q=e.archiveUrl+"details/"+p.identifier;b="images/albumdefault_50.7c4beb44.jpg",c="images/albumdefault_160.jpg",g=5==parseInt(p.avg_rating)?!0:!1,h="undefined"==typeof p.title?"&nbsp;":p.title.toString(),m="undefined"==typeof p.identifier?"&nbsp;":p.identifier.toString(),i="undefined"==typeof p.collection[0]?"&nbsp;":p.collection[0].toString(),n="undefined"==typeof p.source?"&nbsp;":p.source.toString(),o="undefined"==typeof p.date?"&nbsp;":p.date.toString(),j="undefined"==typeof p.publisher?"&nbsp;":p.publisher.toString(),k="undefined"==typeof p.avg_rating?"&nbsp;":p.avg_rating.toString(),l="undefined"==typeof p.downloads?"&nbsp;":p.downloads.toString();var r="<b>Source</b>: "+n+"<br />";return r+="<b>Date</b>: "+o+"<br />",r+="<b>Transferer</b>: "+j+"<br />",r+="<b>Rating</b>: "+k+"<br />",r+="<b>Downloads</b>: "+l+"<br />",new f.Album(m,null,h,i,"",b,c,$.format.date(new Date(p.publicdate),"yyyy-MM-dd h:mm a"),g,d.trustAsHtml(r),q)},m=function(a,b,c,d,e,h){var i,j,k,l,m="";return"VBR MP3"==b.format?(i="http://"+c+d+a,m="undefined"==typeof b.bitrate||"undefined"==typeof b.format?"&nbsp;":b.bitrate+"kbps, "+b.format.toLowerCase(),k="undefined"==typeof b.track?"&nbsp;":b.track,l="undefined"==typeof b.title?"&nbsp;":b.title,j="undefined"==typeof b.length?"&nbsp;":g.timeToSeconds(b.length),new f.Song(b.md5,e,b.track,l,b.creator,"",b.album,"",h,h,j,"","","mp3",m,i,0,"")):void 0};return{getArtists:function(a){var b=c.defer();e.settings.Debug&&console.log("LOAD ARCHIVE.ORG COLLECTIONS");var d=e.archiveUrl+"advancedsearch.php?q=";return d+=""!==a?"mediatype:(collection) AND identifier:("+a+")":"collection:(collection)",d+="&fl[]=identifier&sort[]=&sort[]=&sort[]=&rows=50&page=1&output=json",$.ajax({url:d,method:"GET",dataType:e.settings.Protocol,timeout:e.settings.Timeout,success:function(a){if(a.response.docs.length>0){var c=a.response.docs;k.artist=[],angular.forEach(c,function(a,b){k.artist.push(a.identifier)})}else i.updateMessage("Sorry :(",!0);b.resolve(k)}}),b.promise},getAlbums:function(a,b){var d=c.defer();if(a){var f=e.archiveUrl+"advancedsearch.php?q=";""!==a?(k.selectedArtist=a,f+="collection:("+a+") AND format:(MP3)"):k.selectedArtist?(a=k.selectedArtist,f+="collection:("+k.selectedArtist+") AND format:(MP3)"):f+="collection:("+a+")",k.breadcrumb=[],k.breadcrumb.push({type:"artist",id:a,name:a}),b.Source&&(f+=" AND source:("+b.Source+")"),b.Year&&parseInt(b.Year)&&(f+=" AND year:("+b.Year+")"),b.Description&&(f+=" AND description:("+b.Description+")"),k.selectedArtist&&(f+="&sort[]="+e.settings.DefaultArchiveAlbumSort),f+="&fl[]=avg_rating,collection,date,description,downloads,headerImage,identifier,publisher,publicdate,source,subject,title,year",f+="&rows=50&page=1&output=json",$.ajax({url:f,method:"GET",dataType:e.settings.Protocol,timeout:e.settings.Timeout,success:function(a){var b=[];a.response.docs.length>0?(b=a.response.docs,k.album=[],k.song=[],angular.forEach(b,function(a,b){k.album.push(l(a))}),i.updateMessage(k.album.length+" Items Returned",!0)):i.updateMessage("Sorry :(",!0),d.resolve(k)},error:function(){i.updateMessage("Archive.org service down :(")}})}else d.resolve(k);return d.promise},getSongs:function(a,b){var d=c.defer();if(a){k.selectedAlbum=a,k.breadcrumb.length>0&&k.breadcrumb.splice(1,k.breadcrumb.length-1),k.breadcrumb.push({type:"album",id:a,name:a});var f=e.archiveUrl+"details/"+a+"?output=json";$.ajax({url:f,method:"GET",dataType:e.settings.Protocol,timeout:e.settings.Timeout,success:function(a){var c="",e=a.server,f=a.dir,g=a.metadata.identifier[0];"undefined"!=typeof a.misc.image&&(c=a.misc.image);var h=a.files;if("add"==b)angular.forEach(h,function(a,b){var d=m(b,a,e,f,g,c);d&&j.queue.push(d)}),i.updateMessage(Object.keys(h).length+" Song(s) Added to Queue",!0);else if("play"==b){j.queue=[],angular.forEach(h,function(a,b){var d=m(b,a,e,f,g,c);d&&j.queue.push(d)});var l=j.queue[0];j.play(l),i.updateMessage(Object.keys(h).length+" Song(s) Added to Queue",!0)}else k.album=[],k.song=[],angular.forEach(h,function(a,b){var d=m(b,a,e,f,g,c);d&&k.song.push(d)});d.resolve(k)}})}else d.resolve(k);return d.promise}}}]),angular.module("jamstash.player.controller",["jamstash.player.service","jamstash.player.directive"]).controller("PlayerController",["$scope","player","globals",function(a,b,c){a.getPlayingSong=b.getPlayingSong,a.play=function(){c.settings.Jukebox?a.sendToJukebox("start"):b.togglePause()},a.pause=function(){c.settings.Jukebox?a.sendToJukebox("stop"):b.togglePause()},a.previousTrack=b.previousTrack,a.nextTrack=b.nextTrack}]),angular.module("jamstash.player.directive",["jamstash.player.service","jamstash.settings.service","jamstash.subsonic.service","jamstash.notifications","jamstash.persistence","jamstash.page"]).directive("jplayer",["$interval","player","globals","subsonic","notifications","persistence","Page",function(a,b,c,d,e,f,g){return{restrict:"EA",template:"<div></div>",link:function(h,i){$(".PlayTrack").on("click",function(a){a.preventDefault(),$(this).hide(),$(".PauseTrack").show()}),$(".PauseTrack").on("click",function(a){a.preventDefault(),$(this).hide(),$(".PlayTrack").show()});var j,k=i.children("div"),l="html,flash";c.settings.ForceFlash&&(l="flash,html");var m=function(){$.jPlayer.timeFormat.showHour=!0,k.jPlayer({swfPath:"bower_components/jplayer/dist/jplayer/jquery.jplayer.swf",wmode:"window",solution:l,supplied:"mp3, oga, m4a",preload:"auto",errorAlerts:!1,warningAlerts:!1,cssSelectorAncestor:"#player",cssSelector:{play:".PlayTrack",pause:".PauseTrack",seekBar:"#audiocontainer .scrubber",playBar:"#audiocontainer .progress",mute:"#action_Mute",unmute:"#action_UnMute",volumeMax:"#action_VolumeMax",currentTime:"#played",duration:"#duration"},setmedia:function(){h.scrobbled=!1},play:function(){h.revealControls()},ended:function(){b.isLastSongPlaying()&&c.settings.AutoPlay?d.getRandomSongs().then(function(a){b.addSongs(a).songEnded(),e.updateMessage("Auto Play Activated...",!0)}):b.songEnded(),h.$apply()},timeupdate:function(a){var b=a.jPlayer.status.currentPercentAbsolute,e=!a.jPlayer.status.paused;!h.scrobbled&&b>30&&e&&(c.settings.Debug&&console.log("LAST.FM SCROBBLE - Percent Played: "+b),d.scrobble(h.currentSong),h.scrobbled=!0)},error:function(a){var b=a.jPlayer.status.currentTime;b&&k.jPlayer("play",b),c.settings.Debug&&(console.log("jPlayer error: ",a.jPlayer.error),console.log("Stream interrupted, retrying from position: ",b))}})};h.$watch(function(){return b.getPlayingSong()},function(a){if(void 0!==a){h.currentSong=a,g.setTitleSong(a),$.fancybox.isOpen&&h.fancyboxOpenImage(a.coverartfull);var d={};"oga"===a.suffix?d={oga:a.url}:"m4a"===a.suffix?d={m4a:a.url}:"mp3"===a.suffix&&(d={mp3:a.url}),k.jPlayer("setMedia",d),c.settings.Jukebox&&(k.jPlayer("mute",!0),h.addToJukebox(a.id)),b.loadSong===!0||c.settings.Jukebox?(b.loadSong=!1,h.revealControls(),k.jPlayer("pause",a.position)):(k.jPlayer("play"),c.settings.NotificationSong&&e.showNotification(a))}}),h.$watch(function(){return b.restartSong},function(a){a===!0&&(k.jPlayer("play",0),h.scrobbled=!1,b.restartSong=!1)}),h.$watch(function(){return b.pauseSong},function(a){k.jPlayer(a===!0?"pause":"play")}),h.$watch(function(){return b.getVolume()},function(a){k.jPlayer("volume",a),c.settings.Debug&&console.log("Volume: "+Math.round(100*a)+"%")}),h.$watch(function(){return c.settings.SaveTrackPosition},function(a){a===!0&&h.startSavePosition()}),h.revealControls=function(){$("#playermiddle").css("visibility","visible"),$("#songdetails").css("visibility","visible")},h.startSavePosition=function(){c.settings.SaveTrackPosition&&(0!==j&&a.cancel(j),j=a(function(){var a=k.data("jPlayer");c.settings.SaveTrackPosition&&void 0!==h.currentSong&&void 0!==a&&a.status.currentTime>0&&a.status.paused===!1&&($("#action_SaveProgress").fadeTo("slow",0).delay(500).fadeTo("slow",1).delay(500).fadeTo("slow",0).delay(500).fadeTo("slow",1),h.currentSong.position=a.status.currentTime,f.saveTrackPosition(h.currentSong),f.saveQueue())},3e4))},j=0,h.currentSong={},h.scrobbled=!1,m(),h.startSavePosition(),$("#audiocontainer .scrubber").mouseover(function(){$(".audiojs .scrubber").stop().animate({height:"8px"})}),$("#audiocontainer .scrubber").mouseout(function(){$(".audiojs .scrubber").stop().animate({height:"4px"})})}}}]),angular.module("jamstash.player.service",["jamstash.settings.service","angular-underscore/utils"]).factory("player",["globals",function(a){var b=1,c={_playingIndex:-1,_playingSong:void 0,queue:[],pauseSong:!1,restartSong:!1,loadSong:!1,play:function(a){var b=c.indexOfSong(a);c._playingIndex=void 0!==b?b:-1,c._playingSong===a?c.restart():c._playingSong=a},togglePause:function(){c.pauseSong?c.pauseSong=!1:c.pauseSong=!0},playFirstSong:function(){c._playingIndex=0,c.play(c.queue[0])},load:function(a){c.loadSong=!0,c.play(a)},restart:function(){c.restartSong=!0},songEnded:function(){a.settings.Repeat?c.restart():c.isLastSongPlaying()===!0?a.settings.LoopQueue&&c.playFirstSong():c.nextTrack()},nextTrack:function(){var a=c.indexOfSong(c._playingSong);if(c._playingIndex=void 0!==a?a:-1,c._playingIndex+1<c.queue.length){var b=c.queue[c._playingIndex+1];c._playingIndex++,c.play(b)}},previousTrack:function(){var a=c.indexOfSong(c._playingSong);if(c._playingIndex=void 0!==a?a:-1,c._playingIndex-1>0){var b=c.queue[c._playingIndex-1];c._playingIndex--,c.play(b)}else c.queue.length>0&&c.playFirstSong()},emptyQueue:function(){return c.queue=[],c},shuffleQueue:function(){return c.queue=_(c.queue).shuffle(),c},addSong:function(a){return c.queue.push(a),c},addSongs:function(a){return c.queue=c.queue.concat(a),c},removeSong:function(a){var b=c.queue.indexOf(a);return c.queue.splice(b,1),c},removeSongs:function(a){return c.queue=_(c.queue).difference(a),c},getPlayingSong:function(){return c._playingSong},isLastSongPlaying:function(){return c._playingIndex+1===c.queue.length},indexOfSong:function(a){for(var b=c.queue.length-1;b>=0;b--)if(angular.equals(a,c.queue[b]))return b;return void 0},turnVolumeUp:function(){var a=b;return(a+.1>1||0>a)&&(a=.9),a+=.1,b=Math.round(100*a)/100,a},turnVolumeDown:function(){var a=b;return(a>1||0>a-.1)&&(a=.1),a-=.1,b=Math.round(100*a)/100,a},getVolume:function(){return b},setVolume:function(a){return a>1?a=1:0>a&&(a=0),b=Math.round(100*a)/100,c}};return c}]),angular.module("jamstash.queue.controller",["jamstash.player.service"]).controller("QueueController",["$scope","globals","player",function(a,b,c){a.settings=b.settings,a.player=c,a.playSong=function(a){c.play(a)},a.emptyQueue=function(){c.emptyQueue(),$.fancybox.close()},a.shuffleQueue=function(){c.shuffleQueue()},a.addSongToQueue=function(a){c.addSong(a)},a.removeSongFromQueue=function(a){c.removeSong(a)},a.removeSelectedSongsFromQueue=function(){c.removeSongs(a.selectedSongs)},a.isPlayingSong=function(a){return angular.equals(a,c.getPlayingSong())},a.$watch(function(){return c.getPlayingSong()},function(a){void 0!==a&&$("#SideBar").stop().scrollTo(".song.id"+a.id,400)}),a.dragStart=function(a,b){b.item.data("start",b.item.index())},a.dragEnd=function(a,b){var d=b.item.data("start"),e=b.item.index();c.queue.splice(e,0,c.queue.splice(d,1)[0])}}]),angular.module("JamStash").filter("capitalize",function(){return function(a,b){return a.substring(0,1).toUpperCase()+a.substring(1)}}).filter("musicfolder",function(){return function(a,b){return a.slice(1,a.length)}}).filter("capitalize",function(){return function(a,b){return a.substring(0,1).toUpperCase()+a.substring(1)}}),angular.module("JamStash").directive("sortable",function(){return{link:function(a,b,c){b.sortable({start:a.dragStart,update:a.dragEnd}),b.disableSelection()}}}).directive("fancybox",["$compile",function(a){return{restrict:"A",replace:!1,link:function(b,c,d){b.fancyboxOpen=function(){var d=angular.element(c.html()),e=a(d);$.fancybox.open(d),e(b)}}}}]).directive("songpreview",["$compile","subsonic",function(a,b){return{restrict:"E",templateUrl:"common/songs.html",replace:!1,scope:{song:"@"},link:function(a,c,d){b.getSongTemplate(function(b){a.song=b,$.fancybox.open(c)})}}}]).directive("stopEvent",function(){return{restrict:"A",link:function(a,b,c){b.bind(c.stopEvent,function(a){a.stopPropagation()})}}}).directive("ngEnter",function(){return{scope:{onEnter:"&"},link:function(a,b){console.log(a),b.bind("keydown keypress",function(b){13===b.which&&(a.onEnter(),a.$apply())})}}}).directive("ngDownload",["$compile",function(a){return{restrict:"E",scope:{data:"="},link:function(b,c,d){function e(){return URL.createObjectURL(new Blob([JSON.stringify(b.data)],{type:"application/json"}))}c.append(a('<a class="button" download="backup.json"href="'+e()+'">Download</a>')(b)),b.$watch(b.data,function(){c.children()[0].href=e()})}}}]).directive("stopEvent",function(){return{restrict:"A",link:function(a,b,c){b.bind(c.stopEvent,function(a){a.stopPropagation()})}}}).directive("ngEnter",function(){return function(a,b,c){b.bind("keydown keypress",function(b){13===b.which&&(a.$apply(function(){a.$eval(c.ngEnter)}),b.preventDefault())})}}).directive("ngMsgs",function(){return{restrict:"E",transclude:!1,scope:{msgs:"="},template:'<span id="msg_{{$index}}" class="message">{{ item }}</span>',link:function(a,b,c){a.$watch(a.Messages,function(){var c=$compile(template(a));b.append(c),$(b).parent().fadeIn()})}}});